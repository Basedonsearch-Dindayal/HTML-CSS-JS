<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Whatsapp</title>
    <link rel="stylesheet" href="/style.css"/>
    <style>
        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: rgba(232, 215, 122, 0.9); /* Same as new.ejs */
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            position: relative;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>All Chats</h1>
    <button class="newchat" onclick="openModal()"><b>New Chat</b></button> <!-- Button to open modal -->
    <br/>
    <% for(let chat of chats){ %>
        <div class="chat">
            <p><b>From: </b><%= chat.from %></p>
            <p><b>To: </b><%= chat.to %></p>
            <div class="msg">   
                <p><b>Msg:</b> <%= chat.msg %></p>
            </div>
        </div>
    <% } %>

    <!-- Modal for New Chat -->
    <div id="newChatModal" class="modal">
        <div class="modal-content">
            <button class="close-button" onclick="closeModal()">&times;</button> <!-- Close button -->
            <h2>Write New Chat</h2>
            <form action="/chats" method="POST">
                <label for="from">Who are you</label>
                <input type="text" placeholder="Who are you" name="from" required>
                
                <label for="msg">Write something here...</label>
                <textarea name="msg" placeholder="Write something here..." required></textarea>
                
                <label for="to">Add receiver</label>
                <input type="text" placeholder="Add receiver" name="to" required>
                
                <button type="submit">Create Chat</button>
            </form>
        </div>
    </div>

    <script>
        // JavaScript to handle modal open/close
        function openModal() {
            document.getElementById("newChatModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("newChatModal").style.display = "none";
        }

        // Close modal if clicked outside the modal content
        window.onclick = function(event) {
            const modal = document.getElementById("newChatModal");
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>